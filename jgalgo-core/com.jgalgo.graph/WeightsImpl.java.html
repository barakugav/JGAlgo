<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>WeightsImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JGAlgo - Core</a> &gt; <a href="index.source.html" class="el_package">com.jgalgo.graph</a> &gt; <span class="el_source">WeightsImpl.java</span></div><h1>WeightsImpl.java</h1><pre class="source lang-java linenums">/*-
 * Copyright 2023 Barak Ugav
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
package com.jgalgo.graph;

import java.util.Collections;
import java.util.Map;
import java.util.Objects;
import java.util.Set;
import it.unimi.dsi.fastutil.ints.IntSet;
import it.unimi.dsi.fastutil.objects.Object2ObjectOpenHashMap;

interface WeightsImpl&lt;E&gt; extends Weights&lt;E&gt; {

	static interface Index&lt;E&gt; extends WeightsImpl&lt;E&gt; {

	}

	static abstract class IndexAbstract&lt;E&gt; implements WeightsImpl.Index&lt;E&gt; {

		final GraphElementSet elements;

<span class="fc" id="L35">		IndexAbstract(GraphElementSet elements) {</span>
<span class="fc" id="L36">			this.elements = elements;</span>
<span class="fc" id="L37">		}</span>

		public int size() {
<span class="fc" id="L40">			return elements.size();</span>
		}

		void checkIdx(int idx) {
<span class="fc" id="L44">			elements.checkIdx(idx);</span>
<span class="fc" id="L45">		}</span>

	}

	static interface IndexMutable&lt;E&gt; extends WeightsImpl.Index&lt;E&gt; {

		int capacity();

		void expand(int newCapacity);

		void clear(int idx);

		void clear();

		void swap(int idx1, int idx2);

		static &lt;D&gt; WeightsImpl.IndexMutable&lt;D&gt; newInstance(GraphElementSet elements, Class&lt;? super D&gt; type, D defVal) {
			Weights&lt;?&gt; container;
<span class="fc bfc" id="L63" title="All 2 branches covered.">			if (type == byte.class) {</span>
<span class="fc bfc" id="L64" title="All 2 branches covered.">				byte defVal0 = defVal != null ? ((java.lang.Byte) defVal).byteValue() : 0;</span>
<span class="fc" id="L65">				container = new WeightsImplByte.IndexMutable(elements, defVal0);</span>

<span class="fc bfc" id="L67" title="All 2 branches covered.">			} else if (type == short.class) {</span>
<span class="fc bfc" id="L68" title="All 2 branches covered.">				short defVal0 = defVal != null ? ((java.lang.Short) defVal).shortValue() : 0;</span>
<span class="fc" id="L69">				container = new WeightsImplShort.IndexMutable(elements, defVal0);</span>

<span class="fc bfc" id="L71" title="All 2 branches covered.">			} else if (type == int.class) {</span>
<span class="fc bfc" id="L72" title="All 2 branches covered.">				int defVal0 = defVal != null ? ((Integer) defVal).intValue() : 0;</span>
<span class="fc" id="L73">				container = new WeightsImplInt.IndexMutable(elements, defVal0);</span>

<span class="fc bfc" id="L75" title="All 2 branches covered.">			} else if (type == long.class) {</span>
<span class="fc bfc" id="L76" title="All 2 branches covered.">				long defVal0 = defVal != null ? ((java.lang.Long) defVal).longValue() : 0;</span>
<span class="fc" id="L77">				container = new WeightsImplLong.IndexMutable(elements, defVal0);</span>

<span class="fc bfc" id="L79" title="All 2 branches covered.">			} else if (type == float.class) {</span>
<span class="fc bfc" id="L80" title="All 2 branches covered.">				float defVal0 = defVal != null ? ((java.lang.Float) defVal).floatValue() : 0;</span>
<span class="fc" id="L81">				container = new WeightsImplFloat.IndexMutable(elements, defVal0);</span>

<span class="fc bfc" id="L83" title="All 2 branches covered.">			} else if (type == double.class) {</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">				double defVal0 = defVal != null ? ((java.lang.Double) defVal).doubleValue() : 0;</span>
<span class="fc" id="L85">				container = new WeightsImplDouble.IndexMutable(elements, defVal0);</span>

<span class="fc bfc" id="L87" title="All 2 branches covered.">			} else if (type == boolean.class) {</span>
<span class="fc bfc" id="L88" title="All 2 branches covered.">				boolean defVal0 = defVal != null ? ((Boolean) defVal).booleanValue() : false;</span>
<span class="fc" id="L89">				container = new WeightsImplBool.IndexMutable(elements, defVal0);</span>

<span class="fc bfc" id="L91" title="All 2 branches covered.">			} else if (type == char.class) {</span>
<span class="fc bfc" id="L92" title="All 2 branches covered.">				char defVal0 = defVal != null ? ((Character) defVal).charValue() : 0;</span>
<span class="fc" id="L93">				container = new WeightsImplChar.IndexMutable(elements, defVal0);</span>

<span class="fc" id="L95">			} else {</span>
<span class="fc" id="L96">				container = new WeightsImplObj.IndexMutable&lt;&gt;(elements, defVal);</span>
			}
			@SuppressWarnings(&quot;unchecked&quot;)
<span class="fc" id="L99">			WeightsImpl.IndexMutable&lt;D&gt; container0 = (WeightsImpl.IndexMutable&lt;D&gt;) container;</span>
<span class="fc" id="L100">			return container0;</span>
		}

		static WeightsImpl.IndexMutable&lt;?&gt; copyOf(Weights&lt;?&gt; weights, GraphElementSet elements) {
<span class="pc bpc" id="L104" title="1 of 2 branches missed.">			if (weights instanceof WeightsImpl.ImmutableView&lt;?&gt;)</span>
<span class="nc" id="L105">				weights = ((WeightsImpl.ImmutableView&lt;?&gt;) weights).weights;</span>
<span class="fc bfc" id="L106" title="All 2 branches covered.">			if (weights instanceof WeightsImplByte.IndexImpl) {</span>
<span class="fc" id="L107">				return new WeightsImplByte.IndexMutable((WeightsImplByte.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L108" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplShort.IndexImpl) {</span>
<span class="fc" id="L109">				return new WeightsImplShort.IndexMutable((WeightsImplShort.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L110" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplInt.IndexImpl) {</span>
<span class="fc" id="L111">				return new WeightsImplInt.IndexMutable((WeightsImplInt.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L112" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplLong.IndexImpl) {</span>
<span class="fc" id="L113">				return new WeightsImplLong.IndexMutable((WeightsImplLong.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L114" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplFloat.IndexImpl) {</span>
<span class="fc" id="L115">				return new WeightsImplFloat.IndexMutable((WeightsImplFloat.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplDouble.IndexImpl) {</span>
<span class="fc" id="L117">				return new WeightsImplDouble.IndexMutable((WeightsImplDouble.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L118" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplBool.IndexImpl) {</span>
<span class="fc" id="L119">				return new WeightsImplBool.IndexMutable((WeightsImplBool.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L120" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplChar.IndexImpl) {</span>
<span class="fc" id="L121">				return new WeightsImplChar.IndexMutable((WeightsImplChar.IndexImpl) weights, elements);</span>
<span class="pc bpc" id="L122" title="1 of 2 branches missed.">			} else if (weights instanceof WeightsImplObj.IndexImpl) {</span>
<span class="fc" id="L123">				return new WeightsImplObj.IndexMutable&lt;&gt;((WeightsImplObj.IndexImpl&lt;?&gt;) weights, elements);</span>
			} else {
<span class="nc" id="L125">				throw new IllegalArgumentException(&quot;unknown weights implementation: &quot; + weights.getClass());</span>
			}
		}

		static class Manager {

<span class="fc" id="L131">			final Map&lt;Object, WeightsImpl.IndexMutable&lt;?&gt;&gt; weights = new Object2ObjectOpenHashMap&lt;&gt;();</span>
			private int weightsCapacity;

<span class="fc" id="L134">			Manager(int initCapacity) {</span>
<span class="fc" id="L135">				weightsCapacity = initCapacity;</span>
<span class="fc" id="L136">			}</span>

			Manager(Manager orig, GraphElementSet elements) {
<span class="fc" id="L139">				this(elements.size());</span>
<span class="fc bfc" id="L140" title="All 2 branches covered.">				for (var entry : orig.weights.entrySet())</span>
<span class="fc" id="L141">					weights.put(entry.getKey(), WeightsImpl.IndexMutable.copyOf(entry.getValue(), elements));</span>
<span class="fc" id="L142">			}</span>

			void addWeights(Object key, WeightsImpl.IndexMutable&lt;?&gt; weight) {
<span class="fc" id="L145">				WeightsImpl.IndexMutable&lt;?&gt; oldContainer = weights.put(key, weight);</span>
<span class="pc bpc" id="L146" title="1 of 2 branches missed.">				if (oldContainer != null)</span>
<span class="nc" id="L147">					throw new IllegalArgumentException(&quot;Two weights types with the same key: &quot; + key);</span>
<span class="fc bfc" id="L148" title="All 2 branches covered.">				if (weightsCapacity &gt; weight.capacity())</span>
<span class="fc" id="L149">					weight.expand(weightsCapacity);</span>
<span class="fc" id="L150">			}</span>

			void removeWeights(Object key) {
<span class="fc" id="L153">				weights.remove(key);</span>
<span class="fc" id="L154">			}</span>

			@SuppressWarnings(&quot;unchecked&quot;)
			&lt;E, WeightsT extends Weights&lt;E&gt;&gt; WeightsT getWeights(Object key) {
<span class="fc" id="L158">				return (WeightsT) weights.get(key);</span>
			}

			Set&lt;Object&gt; weightsKeys() {
<span class="fc" id="L162">				return Collections.unmodifiableSet(weights.keySet());</span>
			}

			void ensureCapacity(int capacity) {
<span class="fc bfc" id="L166" title="All 2 branches covered.">				if (capacity &lt;= weightsCapacity)</span>
<span class="fc" id="L167">					return;</span>
<span class="fc" id="L168">				int newCapacity = Math.max(Math.max(2, 2 * weightsCapacity), capacity);</span>
<span class="fc bfc" id="L169" title="All 2 branches covered.">				for (WeightsImpl.IndexMutable&lt;?&gt; container : weights.values())</span>
<span class="fc" id="L170">					container.expand(newCapacity);</span>
<span class="fc" id="L171">				weightsCapacity = newCapacity;</span>
<span class="fc" id="L172">			}</span>

			void swapElements(int idx1, int idx2) {
<span class="fc bfc" id="L175" title="All 2 branches covered.">				for (WeightsImpl.IndexMutable&lt;?&gt; container : weights.values())</span>
<span class="fc" id="L176">					container.swap(idx1, idx2);</span>
<span class="fc" id="L177">			}</span>

			void clearElement(int idx) {
<span class="fc bfc" id="L180" title="All 2 branches covered.">				for (WeightsImpl.IndexMutable&lt;?&gt; container : weights.values())</span>
<span class="fc" id="L181">					container.clear(idx);</span>
<span class="fc" id="L182">			}</span>

			void clearContainers() {
<span class="fc bfc" id="L185" title="All 2 branches covered.">				for (WeightsImpl.IndexMutable&lt;?&gt; container : weights.values())</span>
<span class="fc" id="L186">					container.clear();</span>
<span class="fc" id="L187">			}</span>
		}

	}

	static interface IndexImmutable&lt;E&gt; extends WeightsImpl&lt;E&gt; {

		static WeightsImpl.IndexImmutable&lt;?&gt; copyOf(Weights&lt;?&gt; weights, GraphElementSet.FixedSize elements) {
<span class="pc bpc" id="L195" title="1 of 2 branches missed.">			if (weights instanceof WeightsImpl.ImmutableView&lt;?&gt;)</span>
<span class="nc" id="L196">				weights = ((WeightsImpl.ImmutableView&lt;?&gt;) weights).weights;</span>
<span class="fc bfc" id="L197" title="All 2 branches covered.">			if (weights instanceof WeightsImplByte.IndexImpl) {</span>
<span class="fc" id="L198">				return new WeightsImplByte.IndexImmutable((WeightsImplByte.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplShort.IndexImpl) {</span>
<span class="fc" id="L200">				return new WeightsImplShort.IndexImmutable((WeightsImplShort.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplInt.IndexImpl) {</span>
<span class="fc" id="L202">				return new WeightsImplInt.IndexImmutable((WeightsImplInt.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L203" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplLong.IndexImpl) {</span>
<span class="fc" id="L204">				return new WeightsImplLong.IndexImmutable((WeightsImplLong.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L205" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplFloat.IndexImpl) {</span>
<span class="fc" id="L206">				return new WeightsImplFloat.IndexImmutable((WeightsImplFloat.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L207" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplDouble.IndexImpl) {</span>
<span class="fc" id="L208">				return new WeightsImplDouble.IndexImmutable((WeightsImplDouble.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L209" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplBool.IndexImpl) {</span>
<span class="fc" id="L210">				return new WeightsImplBool.IndexImmutable((WeightsImplBool.IndexImpl) weights, elements);</span>
<span class="fc bfc" id="L211" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplChar.IndexImpl) {</span>
<span class="fc" id="L212">				return new WeightsImplChar.IndexImmutable((WeightsImplChar.IndexImpl) weights, elements);</span>
<span class="pc bpc" id="L213" title="1 of 2 branches missed.">			} else if (weights instanceof WeightsImplObj.IndexImpl) {</span>
<span class="fc" id="L214">				return new WeightsImplObj.IndexImmutable&lt;&gt;((WeightsImplObj.IndexImpl&lt;?&gt;) weights, elements);</span>
			} else {
<span class="nc" id="L216">				throw new IllegalArgumentException(&quot;unknown weights implementation: &quot; + weights.getClass());</span>
			}
		}

		static WeightsImpl.IndexImmutable&lt;?&gt; copyOfReindexed(Weights&lt;?&gt; weights, GraphElementSet.FixedSize elements,
				IndexGraphBuilder.ReIndexingMap reIndexMap) {
<span class="pc bpc" id="L222" title="1 of 2 branches missed.">			if (weights instanceof WeightsImpl.ImmutableView&lt;?&gt;)</span>
<span class="nc" id="L223">				weights = ((WeightsImpl.ImmutableView&lt;?&gt;) weights).weights;</span>
<span class="fc bfc" id="L224" title="All 2 branches covered.">			if (weights instanceof WeightsImplByte.IndexImpl) {</span>
<span class="fc" id="L225">				return new WeightsImplByte.IndexImmutable((WeightsImplByte.IndexImpl) weights, elements, reIndexMap);</span>
<span class="fc bfc" id="L226" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplShort.IndexImpl) {</span>
<span class="fc" id="L227">				return new WeightsImplShort.IndexImmutable((WeightsImplShort.IndexImpl) weights, elements, reIndexMap);</span>
<span class="fc bfc" id="L228" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplInt.IndexImpl) {</span>
<span class="fc" id="L229">				return new WeightsImplInt.IndexImmutable((WeightsImplInt.IndexImpl) weights, elements, reIndexMap);</span>
<span class="fc bfc" id="L230" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplLong.IndexImpl) {</span>
<span class="fc" id="L231">				return new WeightsImplLong.IndexImmutable((WeightsImplLong.IndexImpl) weights, elements, reIndexMap);</span>
<span class="fc bfc" id="L232" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplFloat.IndexImpl) {</span>
<span class="fc" id="L233">				return new WeightsImplFloat.IndexImmutable((WeightsImplFloat.IndexImpl) weights, elements, reIndexMap);</span>
<span class="fc bfc" id="L234" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplDouble.IndexImpl) {</span>
<span class="fc" id="L235">				return new WeightsImplDouble.IndexImmutable((WeightsImplDouble.IndexImpl) weights, elements,</span>
						reIndexMap);
<span class="fc bfc" id="L237" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplBool.IndexImpl) {</span>
<span class="fc" id="L238">				return new WeightsImplBool.IndexImmutable((WeightsImplBool.IndexImpl) weights, elements, reIndexMap);</span>
<span class="fc bfc" id="L239" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplChar.IndexImpl) {</span>
<span class="fc" id="L240">				return new WeightsImplChar.IndexImmutable((WeightsImplChar.IndexImpl) weights, elements, reIndexMap);</span>
<span class="pc bpc" id="L241" title="1 of 2 branches missed.">			} else if (weights instanceof WeightsImplObj.IndexImpl) {</span>
<span class="fc" id="L242">				return new WeightsImplObj.IndexImmutable&lt;&gt;((WeightsImplObj.IndexImpl&lt;?&gt;) weights, elements, reIndexMap);</span>
			} else {
<span class="nc" id="L244">				throw new IllegalArgumentException(&quot;unknown weights implementation: &quot; + weights.getClass());</span>
			}
		}

		static class Builder {

			private final GraphElementSet.FixedSize elements;
			private final Map&lt;Object, WeightsImpl.IndexImmutable&lt;?&gt;&gt; weights;

<span class="fc" id="L253">			Builder(GraphElementSet.FixedSize elements) {</span>
<span class="fc" id="L254">				this.elements = Objects.requireNonNull(elements);</span>
<span class="fc" id="L255">				weights = new Object2ObjectOpenHashMap&lt;&gt;();</span>
<span class="fc" id="L256">			}</span>

			void copyAndAddWeights(Object key, Weights&lt;?&gt; weights) {
<span class="fc" id="L259">				Object oldWeights = this.weights.put(key, WeightsImpl.IndexImmutable.copyOf(weights, elements));</span>
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">				if (oldWeights != null)</span>
<span class="nc" id="L261">					throw new IllegalArgumentException(&quot;duplicate key: &quot; + key);</span>
<span class="fc" id="L262">			}</span>

			void copyAndAddWeightsReindexed(Object key, Weights&lt;?&gt; weights,
					IndexGraphBuilder.ReIndexingMap reIndexMap) {
<span class="fc" id="L266">				Object oldWeights = this.weights.put(key,</span>
<span class="fc" id="L267">						WeightsImpl.IndexImmutable.copyOfReindexed(weights, elements, reIndexMap));</span>
<span class="pc bpc" id="L268" title="1 of 2 branches missed.">				if (oldWeights != null)</span>
<span class="nc" id="L269">					throw new IllegalArgumentException(&quot;duplicate key: &quot; + key);</span>
<span class="fc" id="L270">			}</span>

			Map&lt;Object, WeightsImpl.IndexImmutable&lt;?&gt;&gt; build() {
<span class="fc" id="L273">				return Map.copyOf(weights);</span>
			}
		}

	}

	static abstract class Mapped&lt;E&gt; implements WeightsImpl&lt;E&gt; {

		final WeightsImpl.IndexAbstract&lt;E&gt; weights;
		final IndexIdMap indexMap;

<span class="fc" id="L284">		Mapped(WeightsImpl.Index&lt;E&gt; weights, IndexIdMap indexMap) {</span>
<span class="fc" id="L285">			this.weights = (WeightsImpl.IndexAbstract&lt;E&gt;) Objects.requireNonNull(weights);</span>
<span class="fc" id="L286">			this.indexMap = indexMap;</span>
<span class="fc" id="L287">		}</span>

		WeightsImpl.IndexAbstract&lt;E&gt; weights() {
<span class="fc" id="L290">			return weights;</span>
		}

		@SuppressWarnings({ &quot;unchecked&quot;, &quot;rawtypes&quot; })
		static WeightsImpl.Mapped&lt;?&gt; newInstance(WeightsImpl.Index&lt;?&gt; weights, IndexIdMap indexMap) {
<span class="fc bfc" id="L295" title="All 2 branches covered.">			if (weights instanceof WeightsImplByte.IndexImpl) {</span>
<span class="fc" id="L296">				return new WeightsImplByte.Mapped((WeightsImplByte.IndexImpl) weights, indexMap);</span>
<span class="fc bfc" id="L297" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplShort.IndexImpl) {</span>
<span class="fc" id="L298">				return new WeightsImplShort.Mapped((WeightsImplShort.IndexImpl) weights, indexMap);</span>
<span class="fc bfc" id="L299" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplInt.IndexImpl) {</span>
<span class="fc" id="L300">				return new WeightsImplInt.Mapped((WeightsImplInt.IndexImpl) weights, indexMap);</span>
<span class="fc bfc" id="L301" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplLong.IndexImpl) {</span>
<span class="fc" id="L302">				return new WeightsImplLong.Mapped((WeightsImplLong.IndexImpl) weights, indexMap);</span>
<span class="fc bfc" id="L303" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplFloat.IndexImpl) {</span>
<span class="fc" id="L304">				return new WeightsImplFloat.Mapped((WeightsImplFloat.IndexImpl) weights, indexMap);</span>
<span class="fc bfc" id="L305" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplDouble.IndexImpl) {</span>
<span class="fc" id="L306">				return new WeightsImplDouble.Mapped((WeightsImplDouble.IndexImpl) weights, indexMap);</span>
<span class="fc bfc" id="L307" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplBool.IndexImpl) {</span>
<span class="fc" id="L308">				return new WeightsImplBool.Mapped((WeightsImplBool.IndexImpl) weights, indexMap);</span>
<span class="fc bfc" id="L309" title="All 2 branches covered.">			} else if (weights instanceof WeightsImplChar.IndexImpl) {</span>
<span class="fc" id="L310">				return new WeightsImplChar.Mapped((WeightsImplChar.IndexImpl) weights, indexMap);</span>
			} else {
<span class="fc" id="L312">				return new WeightsImplObj.Mapped&lt;&gt;((WeightsImplObj.IndexImpl) weights, indexMap);</span>
			}
		}

	}

	static interface Immutable&lt;E&gt; extends WeightsImpl&lt;E&gt; {

	}

	static abstract class ImmutableView&lt;E&gt; implements Immutable&lt;E&gt; {

		final Weights&lt;E&gt; weights;

<span class="fc" id="L326">		ImmutableView(Weights&lt;E&gt; weights) {</span>
<span class="fc" id="L327">			this.weights = Objects.requireNonNull(weights);</span>
<span class="fc" id="L328">		}</span>

		Weights&lt;E&gt; weights() {
<span class="fc" id="L331">			return weights;</span>
		}

		@SuppressWarnings(&quot;unchecked&quot;)
		static &lt;E&gt; Weights&lt;E&gt; newInstance(Weights&lt;E&gt; weights) {
<span class="pc bpc" id="L336" title="1 of 2 branches missed.">			if (weights instanceof Immutable&lt;?&gt;)</span>
<span class="nc" id="L337">				return weights;</span>
<span class="fc bfc" id="L338" title="All 2 branches covered.">			if (weights instanceof WeightsByte)</span>
<span class="fc" id="L339">				return (Weights&lt;E&gt;) new WeightsImplByte.ImmutableView((WeightsByte) weights);</span>
<span class="fc bfc" id="L340" title="All 2 branches covered.">			if (weights instanceof WeightsShort)</span>
<span class="fc" id="L341">				return (Weights&lt;E&gt;) new WeightsImplShort.ImmutableView((WeightsShort) weights);</span>
<span class="fc bfc" id="L342" title="All 2 branches covered.">			if (weights instanceof WeightsInt)</span>
<span class="fc" id="L343">				return (Weights&lt;E&gt;) new WeightsImplInt.ImmutableView((WeightsInt) weights);</span>
<span class="fc bfc" id="L344" title="All 2 branches covered.">			if (weights instanceof WeightsLong)</span>
<span class="fc" id="L345">				return (Weights&lt;E&gt;) new WeightsImplLong.ImmutableView((WeightsLong) weights);</span>
<span class="fc bfc" id="L346" title="All 2 branches covered.">			if (weights instanceof WeightsFloat)</span>
<span class="fc" id="L347">				return (Weights&lt;E&gt;) new WeightsImplFloat.ImmutableView((WeightsFloat) weights);</span>
<span class="fc bfc" id="L348" title="All 2 branches covered.">			if (weights instanceof WeightsDouble)</span>
<span class="fc" id="L349">				return (Weights&lt;E&gt;) new WeightsImplDouble.ImmutableView((WeightsDouble) weights);</span>
<span class="fc bfc" id="L350" title="All 2 branches covered.">			if (weights instanceof WeightsBool)</span>
<span class="fc" id="L351">				return (Weights&lt;E&gt;) new WeightsImplBool.ImmutableView((WeightsBool) weights);</span>
<span class="fc bfc" id="L352" title="All 2 branches covered.">			if (weights instanceof WeightsChar)</span>
<span class="fc" id="L353">				return (Weights&lt;E&gt;) new WeightsImplChar.ImmutableView((WeightsChar) weights);</span>
<span class="pc bpc" id="L354" title="1 of 2 branches missed.">			if (weights instanceof WeightsObj)</span>
<span class="fc" id="L355">				return new WeightsImplObj.ImmutableView&lt;&gt;((WeightsObj&lt;E&gt;) weights);</span>
<span class="nc" id="L356">			throw new IllegalArgumentException(&quot;Unsupported weights type: &quot; + weights.getClass());</span>
		}
	}

	static void checkSameSize(GraphElementSet i1, GraphElementSet i2) {
<span class="pc bpc" id="L361" title="1 of 2 branches missed.">		if (i1.size() != i2.size())</span>
<span class="nc" id="L362">			throw new IllegalArgumentException(&quot;Elements sets size mismatch: &quot; + i1.size() + &quot; != &quot; + i2.size());</span>
<span class="fc" id="L363">	}</span>

	static boolean isEqual(IntSet elementsSet, Weights&lt;?&gt; w1, Weights&lt;?&gt; w2) {
<span class="fc bfc" id="L366" title="All 2 branches covered.">		if (w1 == w2)</span>
<span class="fc" id="L367">			return true;</span>
<span class="pc bpc" id="L368" title="1 of 4 branches missed.">		if (w1 instanceof WeightsObj&lt;?&gt; &amp;&amp; w2 instanceof WeightsObj&lt;?&gt;) {</span>
<span class="fc bfc" id="L369" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L370" title="1 of 2 branches missed.">				if (!Objects.equals(((WeightsObj&lt;?&gt;) w1).get(elm), ((WeightsObj&lt;?&gt;) w2).get(elm)))</span>
<span class="nc" id="L371">					return false;</span>
<span class="fc" id="L372">			return true;</span>
<span class="pc bpc" id="L373" title="1 of 4 branches missed.">		} else if (w1 instanceof WeightsByte &amp;&amp; w2 instanceof WeightsByte) {</span>
<span class="fc bfc" id="L374" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L375" title="1 of 2 branches missed.">				if (((WeightsByte) w1).get(elm) != ((WeightsByte) w2).get(elm))</span>
<span class="nc" id="L376">					return false;</span>
<span class="fc" id="L377">			return true;</span>
<span class="pc bpc" id="L378" title="1 of 4 branches missed.">		} else if (w1 instanceof WeightsShort &amp;&amp; w2 instanceof WeightsShort) {</span>
<span class="fc bfc" id="L379" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L380" title="1 of 2 branches missed.">				if (((WeightsShort) w1).get(elm) != ((WeightsShort) w2).get(elm))</span>
<span class="nc" id="L381">					return false;</span>
<span class="fc" id="L382">			return true;</span>
<span class="pc bpc" id="L383" title="1 of 4 branches missed.">		} else if (w1 instanceof WeightsInt &amp;&amp; w2 instanceof WeightsInt) {</span>
<span class="fc bfc" id="L384" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L385" title="1 of 2 branches missed.">				if (((WeightsInt) w1).get(elm) != ((WeightsInt) w2).get(elm))</span>
<span class="nc" id="L386">					return false;</span>
<span class="fc" id="L387">			return true;</span>
<span class="pc bpc" id="L388" title="1 of 4 branches missed.">		} else if (w1 instanceof WeightsLong &amp;&amp; w2 instanceof WeightsLong) {</span>
<span class="fc bfc" id="L389" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L390" title="1 of 2 branches missed.">				if (((WeightsLong) w1).get(elm) != ((WeightsLong) w2).get(elm))</span>
<span class="nc" id="L391">					return false;</span>
<span class="fc" id="L392">			return true;</span>
<span class="pc bpc" id="L393" title="1 of 4 branches missed.">		} else if (w1 instanceof WeightsFloat &amp;&amp; w2 instanceof WeightsFloat) {</span>
<span class="fc bfc" id="L394" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L395" title="1 of 2 branches missed.">				if (((WeightsFloat) w1).get(elm) != ((WeightsFloat) w2).get(elm))</span>
<span class="nc" id="L396">					return false;</span>
<span class="fc" id="L397">			return true;</span>
<span class="pc bpc" id="L398" title="1 of 4 branches missed.">		} else if (w1 instanceof WeightsDouble &amp;&amp; w2 instanceof WeightsDouble) {</span>
<span class="fc bfc" id="L399" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L400" title="1 of 2 branches missed.">				if (((WeightsDouble) w1).get(elm) != ((WeightsDouble) w2).get(elm))</span>
<span class="nc" id="L401">					return false;</span>
<span class="fc" id="L402">			return true;</span>
<span class="pc bpc" id="L403" title="1 of 4 branches missed.">		} else if (w1 instanceof WeightsBool &amp;&amp; w2 instanceof WeightsBool) {</span>
<span class="fc bfc" id="L404" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L405" title="1 of 2 branches missed.">				if (((WeightsBool) w1).get(elm) != ((WeightsBool) w2).get(elm))</span>
<span class="nc" id="L406">					return false;</span>
<span class="fc" id="L407">			return true;</span>
<span class="pc bpc" id="L408" title="2 of 4 branches missed.">		} else if (w1 instanceof WeightsChar &amp;&amp; w2 instanceof WeightsChar) {</span>
<span class="fc bfc" id="L409" title="All 2 branches covered.">			for (int elm : elementsSet)</span>
<span class="pc bpc" id="L410" title="1 of 2 branches missed.">				if (((WeightsChar) w1).get(elm) != ((WeightsChar) w2).get(elm))</span>
<span class="nc" id="L411">					return false;</span>
<span class="fc" id="L412">			return true;</span>
		} else {
<span class="nc" id="L414">			return false;</span>
		}
	}

	static int hashCode(IntSet elementsSet, Weights&lt;?&gt; w) {
<span class="nc" id="L419">		int h = 0;</span>
<span class="nc bnc" id="L420" title="All 2 branches missed.">		if (w instanceof WeightsObj&lt;?&gt;) {</span>
<span class="nc bnc" id="L421" title="All 2 branches missed.">			for (int elm : elementsSet)</span>
<span class="nc" id="L422">				h += Objects.hashCode(((WeightsObj&lt;?&gt;) w).get(elm));</span>
<span class="nc bnc" id="L423" title="All 2 branches missed.">		} else if (w instanceof WeightsByte) {</span>
<span class="nc bnc" id="L424" title="All 2 branches missed.">			for (int elm : elementsSet)</span>
<span class="nc" id="L425">				h += ((WeightsByte) w).get(elm);</span>
<span class="nc bnc" id="L426" title="All 2 branches missed.">		} else if (w instanceof WeightsShort) {</span>
<span class="nc bnc" id="L427" title="All 2 branches missed.">			for (int elm : elementsSet)</span>
<span class="nc" id="L428">				h += ((WeightsShort) w).get(elm);</span>
<span class="nc bnc" id="L429" title="All 2 branches missed.">		} else if (w instanceof WeightsInt) {</span>
<span class="nc bnc" id="L430" title="All 2 branches missed.">			for (int elm : elementsSet)</span>
<span class="nc" id="L431">				h += ((WeightsInt) w).get(elm);</span>
<span class="nc bnc" id="L432" title="All 2 branches missed.">		} else if (w instanceof WeightsLong) {</span>
<span class="nc bnc" id="L433" title="All 2 branches missed.">			for (int elm : elementsSet) {</span>
<span class="nc" id="L434">				long x = ((WeightsLong) w).get(elm);</span>
<span class="nc" id="L435">				h += (int) (x ^ (x &gt;&gt;&gt; 32));</span>
<span class="nc" id="L436">			}</span>
<span class="nc bnc" id="L437" title="All 2 branches missed.">		} else if (w instanceof WeightsFloat) {</span>
<span class="nc bnc" id="L438" title="All 2 branches missed.">			for (int elm : elementsSet)</span>
<span class="nc" id="L439">				h += java.lang.Float.floatToRawIntBits(((WeightsFloat) w).get(elm));</span>
<span class="nc bnc" id="L440" title="All 2 branches missed.">		} else if (w instanceof WeightsDouble) {</span>
<span class="nc bnc" id="L441" title="All 2 branches missed.">			for (int elm : elementsSet) {</span>
<span class="nc" id="L442">				long x = java.lang.Double.doubleToRawLongBits(((WeightsDouble) w).get(elm));</span>
<span class="nc" id="L443">				h += (int) (x ^ (x &gt;&gt;&gt; 32));</span>
<span class="nc" id="L444">			}</span>
<span class="nc bnc" id="L445" title="All 2 branches missed.">		} else if (w instanceof WeightsBool) {</span>
<span class="nc bnc" id="L446" title="All 2 branches missed.">			for (int elm : elementsSet)</span>
<span class="nc bnc" id="L447" title="All 2 branches missed.">				h += ((WeightsBool) w).get(elm) ? 1231 : 1237;</span>
<span class="nc bnc" id="L448" title="All 2 branches missed.">		} else if (w instanceof WeightsChar) {</span>
<span class="nc bnc" id="L449" title="All 2 branches missed.">			for (int elm : elementsSet)</span>
<span class="nc" id="L450">				h += ((WeightsChar) w).get(elm);</span>
		} else {
<span class="nc" id="L452">			throw new IllegalArgumentException(&quot;Unsupported weights type: &quot; + w.getClass());</span>
		}
<span class="nc" id="L454">		return h;</span>
	}

}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.10.202304240956</span></div></body></html>